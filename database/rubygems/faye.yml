---
- id: rubyadvisory:rubygems:faye:CVE-2020-11020
  title: Authentication and extension bypass in Faye
  description: |-
    On 20 April 2020 it was reported to me that the potential for authentication
    bypass exists in [Faye][1]'s extension system. This vulnerability has existed in
    the Node.js and Ruby versions of the server since version 0.5.0, when extensions
    were first introduced, in July 2010. It is patched in versions 1.0.4, 1.1.3 and
    1.2.5, which we are releasing today.

    The vulnerability allows any client to bypass checks put in place by server-side
    extensions, by appending extra segments to the message channel. For example, the
    Faye [extension docs][2] suggest that users implement access control for
    subscriptions by checking incoming messages for the `/meta/subscribe` channel,
    for example:

    ```js
    server.addExtension({
      incoming: function(message, callback) {
        if (message.channel === '/meta/subscribe') {
          if (message.ext.authToken !== 'my super secret password') {
            message.error = 'Invalid auth token';
          }
        }
        callback(message);
      }
    });
    ```

    A bug in the server's code for recognising the special `/meta/*` channels, which
    trigger connection and subscription events, means that a client can bypass this
    check by sending a message to `/meta/subscribe/x` rather than `/meta/subscribe`:

    ```json
    {
      "channel": "/meta/subscribe/x",
      "clientId": "3jrc6602npj4gyp6bn5ap2wqzjtb2q3",
      "subscription": "/foo"
    }
    ```

    This message will not be checked by the above extension, as it checks the
    message's channel is exactly equal to `/meta/subscribe`. But it will still be
    processed as a subscription request by the server, so the client becomes
    subscribed to the channel `/foo` without supplying the necessary credentials.

    The vulnerability is caused by the way the Faye server recognises meta channels.
    It will treat a message to any channel that's a prefix-match for one of the
    special channels `/meta/handshake`, `/meta/connect`, `/meta/subscribe`,
    `/meta/unsubscribe` or `/meta/disconnect`, as though it were an exact match for
    that channel. So, a message to `/meta/subscribe/x` is still processed as a
    subscription request, for example.

    An authentication bypass for subscription requests is the most serious effect of
    this but all other meta channels are susceptible to similar manipulation.

    This parsing bug in the server is fixed in versions 1.0.4, 1.1.3 and 1.2.5.
    These should be drop-in replacements for prior versions and you should upgrade
    immediately if you are running any prior version.

    If you are unable to install one of these versions, you can make your extensions
    catch all messages the server would process by checking the channel _begins_
    with the expected channel name, for example:

    ```js
    server.addExtension({
      incoming: function(message, callback) {
        if (message.channel.startsWith('/meta/subscribe')) {
          // authentication logic
        }
        callback(message);
      }
    });
    ```

    [1]: https://faye.jcoglan.com/
    [2]: https://faye.jcoglan.com/node/extensions.html
  affected_package: faye
  unaffected_versions:
  - "< 0.5.0"
  patched_versions:
  - ">= 1.2.5"
  - "~> 1.0.4"
  - "~> 1.1.3"
  severity: high
  package_manager: rubygems
  cve:
  - CVE-2020-11020
  cvss_v3_score: 8.5
  disclosed_date: 2020-04-29
  created_date: 2020-04-29
  last_modified_date: 2020-04-29
  credit:
  - Rubysec
  references:
  - https://github.com/rubysec/ruby-advisory-db
  source_url: https://github.com/faye/faye/security/advisories/GHSA-qpg4-4w7w-2mq5
- id: snykio:rubygems:faye:567760
  title: Improper Access Control
  description: |
    [faye][1] is a simple pub/sub messaging for the web.

    Affected versions of this package are vulnerable to Improper Access
    Control. The Server parses channels in a way that means any channel
    namespaced under `/meta/subscribe` will also work as a subscription
    request. For example if the client sends a message to the channel
    `/meta/subscribe/x`, that will bypass most authentication extensions but
    will still be interpreted by the server as a subscription request, and
    the client will be subscribed to the requested channel. The client has
    thus bypassed the user\'s access control policy.



    [1]: https://faye.jcoglan.com/
  affected_package: faye
  vulnerable_versions:
  - "<1.0.4"
  - ">=1.1.0  <1.1.3"
  - ">=1.2.0  <1.2.5"
  severity: high
  package_manager: rubygems
  cve:
  - CVE-2020-11020
  cwe:
  - CWE-284
  disclosed_date: 2020-04-28
  created_date: 2020-04-28
  last_modified_date: 2020-04-28
  credit:
  - Unknown
  references:
  - https://github.com/faye/faye/commit/3e22055d314f3dfb4e087cccedd40b21c91788a8
  source_url: https://snyk.io/vuln/SNYK-RUBY-FAYE-567760
- id: snykio:rubygems:faye:567843
  title: Cross-Site Request Forgery (CSRF)
  description: |
    [faye][1] is a simple pub/sub messaging for the web.

    Affected versions of this package are vulnerable to Cross-Site Request
    Forgery (CSRF). Rosetta Flash (alphanum only swf converter) can be used
    as a callback at a JSONP endpoint, and as a result, send data across
    domains.



    [1]: https://faye.jcoglan.com/
  affected_package: faye
  vulnerable_versions:
  - "<1.1.0"
  severity: high
  package_manager: rubygems
  cwe:
  - CWE-352
  disclosed_date: 2014-07-08
  created_date: 2020-04-23
  last_modified_date: 2020-04-23
  credit:
  - Unknown
  references:
  - http://miki.it/blog/2014/7/8/abusing-jsonp-with-rosetta-flash/
  - https://github.com/faye/faye/commit/de93b9d1bb7397631d8357325b4af665f8c1f1e1
  source_url: https://snyk.io/vuln/SNYK-RUBY-FAYE-567843
