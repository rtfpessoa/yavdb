---
- id: npmjs:npm:flatmap-stream:737
  title: Malicious Package
  description: "Version 0.1.1 of `flatmap-stream` is considered malicious.\n\nThis
    module runs an encrypted payload targeting a very specific application, `copay`
    and because they shared the same description it would have likely worked for `copay-dash`.\n\nThe
    injected code:\n\n- Read in AES encrypted data from a file disguised as a test
    fixture\n- Grabbed the npm package description of the module that imported it,
    using an automatically set environment variable\n- Used the package description
    as a key to decrypt a chunk of data pulled in from the disguised file\n\nThe decrypted
    data was part of a module, which was then compiled in memory and executed.\n\nThis
    module performed the following actions:\n\n- Decrypted another chunk of data from
    the disguised file\n- Concatenated a small, commented prefix from the first decrypted
    chunk to the end of the second decrypted chunk\n- Performed minor decoding tasks
    to transform the concatenated block of code from invalid JS to valid JS (we believe
    this was done to evade detection by dynamic analysis tools)\n- Wrote this processed
    block of JS out to a file stored in a dependency that would be packaged by the
    build scripts: \n\nThe chunk of code that was written out was the actual malicious
    code, intended to be run on devices owned by the end users of Copay.\n\nThis code
    would do the following:\n\n- Detect the current environment: Mobile/Cordova/Electron\n-
    Check the Bitcoin and Bitcoin Cash balances on the victim's copay account\n- If
    the current balance was greater than 100 Bitcoin, or 1000 Bitcoin Cash:\n  - Harvest
    the victim's account data in full\n  - Harvest the victim's copay private keys\n
    \ - Send the victim's account data/private keys off to a collection"
  affected_package: flatmap-stream
  vulnerable_versions:
  - 0.1.1
  severity: high
  package_manager: npm
  cwe: CWE-506
  disclosed_date: 1970-01-01
  created_date: 1970-01-01
  last_modified_date: 1970-01-01
  credit: na
- id: snykio:npm:flatmap-stream:72637
  title: Malicious Package
  description: |
    `flatmap-stream` is a malicious package which was used in order to steal
    bitcoins from wallets. The malicious code was able to check if the
    `copay-dash` package was installed, and then attempt to steal the
    bitcoins stored in it. It was distributed by hijacking the popular
    `event-stream` package and adding `flatmap-stream` as a dependency.

    You can read more about the malicious code [on our blog][1].



    [1]: https://snyk.io/blog/malicious-code-found-in-npm-package-event-stream
  affected_package: flatmap-stream
  vulnerable_versions:
  - "*"
  severity: high
  package_manager: npm
  cwe:
  - CWE-506
  disclosed_date: 2018-11-20
  created_date: 2018-11-26
  last_modified_date: 2018-11-26
  credit:
  - Ayrton Sparling
  references:
  - https://github.com/dominictarr/event-stream/issues/116
  - https://github.com/dominictarr/event-stream/issues/116%23issuecomment-441759047
  - https://hackerone.com/reports/450006
  source_url: https://snyk.io/vuln/SNYK-JS-FLATMAPSTREAM-72637
